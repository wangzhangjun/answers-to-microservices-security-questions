### Question

当入侵者攻入内网后，你有哪些防御措施可以使用？

### Answer

这个问题与第一个问题类似，我们都关注当边界被突破后，我们应该采取哪些措施可以进行防御。通常一旦进入内网，其资源是非常容易被使用的，所以最常见的解决方案是在不同的网络层级设置更多的保护措施，例如我们常常将应用实例与数据库分布部署在不同的子网中，同时显示的设置访问控制，这仅仅是在 TCP/IP 层进行的一些操作，同时还可以在应用层做到更多，不同层级的保护措施是可以避免“错误配置”这一种问题的。

在考虑实现这种安全模式前，我们必须搞清楚网络层级与攻击面等现状，一般来说，我们可以从底层网络开始实现，例如很多云平台都已经提供的 VPC 与子网设置，例如公开子网往往会部署一些暴露在公网上的服务，而相关的资源、特别是数据方面，是一定需要放在私有子网内的，再通过 ACL 与其他额外的安全方法进行控制。我们同样需要运行在实例上的安全套件来确保具体运行应用的实例（虚拟机或容器）的安全，在此之上，在具体的应用层我们就可以应用 AppSec 领域的安全方法了，例如针对 OWSAP Top 10 的防御等。在安全领域，永远不要假设一定安全，对于目前使用的这些安全方法来说也是不能百分百的确保安全，特别是在微服务架构中，我们的资源是不断变化的，治理与运维的成本极高，没有自动化的工具来进行监控、警报、操作记录，也就无从谈起安全了。同样的，安全审计也是无法避免的工作。在我们的实践中。管理上百个端点与实例，消除手动控制、实现自动化的治理是最具有挑战的。

### Reference
- [Defense in depth](https://en.wikipedia.org/wiki/Defense_in_depth_(computing))
- [Security Audit](https://en.wikipedia.org/wiki/Information_technology_security_audit)
- [Endpoint Security Products](https://www.tenable.com/blog/endpoint-security-with-nessus-agents)
