### Question

如何确保你的内部网站和管理员的 URL 不会意外地暴露到公网上？

### Answer

大多数时候，严格的网络层面的 ACL 或者 VPC 可以帮助我们保护内网之中的东西（在云环境下这是非常常见的），通常我们有一些 CIDR 块来定义客户端的地址范围，然后给与他们不同的访问权限，比如允许 VPN 或者办公室网络访问你的管理服务所在的私有云。当然，修改访问权限控制必须是要有管理员级别的权限，但是大多数情况下这是静态的，所以危险在于如果有人犯了错误并且几天之内没有人注意到的话，我们甚至都不会知道内部资源已经暴露了，

所以深度防御也是必须的，如果我们有 sidecar 在每个服务上的话，开发一个自制的小模块也可以帮助我们，我们可以检查每个请求的 source ip 是否符合我们的安全策略，对于一个常见的反向代理式的 sidecar，它往往可以处理访问日志、代理、吃掉慢连接并且做一些访问控制，而配置它们只需要几行代码就足够了。虽然这样也解决了我们提出的问题，但是如果有人进入到内网之中，我们依旧面临丢失所有东西的风险，还是那句话，使用边界来保护内网并且假定它安全与否已经有点过时了。

### Reference

- [AWS ACL for VPC](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html)
- [Defense in depth](https://en.wikipedia.org/wiki/Defense_in_depth_(computing))
